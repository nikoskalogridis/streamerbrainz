[Unit]
Description=StreamerBrainz Daemon with Plexamp Integration
Documentation=https://github.com/yourusername/streamerbrainz
After=network.target

[Service]
Type=simple

# Optional but a good idea: hides the runtime creds dir from other services via a mount namespace
PrivateMounts=yes

# Load encrypted credential (create with: systemd-creds encrypt --name=plex-token - - > ~/.config/streamerbrainz/plex-token.cred)
LoadCredentialEncrypted=plex-token:%h/.config/streamerbrainz/plex-token.cred

# Path to the binary
# %d expands to the credential directory for this service
ExecStart=%h/.local/bin/streamerbrainz \
    -input /dev/input/event6 \
    -ws ws://127.0.0.1:1234 \
    -socket %t/streamerbrainz.sock \
    -min -65.0 \
    -max 0.0 \
    -update-hz 100 \
    -plex-enabled \
    -plex-listen :8080 \
    -plex-host plex.home.arpa:32400 \
    -plex-token-file=%d/plex-token \
    -plex-machine-id YOUR_MACHINE_IDENTIFIER_HERE \
    -v

# Restart policy
Restart=on-failure
RestartSec=5s

# Resource limits
LimitNOFILE=65536

# Security hardening
NoNewPrivileges=true
PrivateTmp=true

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=streamerbrainz

[Install]
WantedBy=default.target
